var $$ = Dom7; var myApp = new Framework7(); var mainView = myApp.addView(".view-main", { dynamicNavbar: true }); $$(document).on("ajaxStart", function (a) { if (a.detail.xhr.requestUrl.indexOf("autocomplete-languages.json") >= 0) { return } myApp.showIndicator() }); $$(document).on("ajaxComplete", function (a) { if (a.detail.xhr.requestUrl.indexOf("autocomplete-languages.json") >= 0) { return } myApp.hideIndicator() }); var monthNames = ["一月份", "二月份", "三月份", "四月份", "五月份", "六月份", "七月份", "八月份", "九月份", "十月份", "十一月份", "十二月份"]; var monthNamesShort = ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"]; var dayNames = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"]; var dayNames = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"]; var dayNamesShort = ["日", "一", "二", "三", "四", "五", "六"]; $$(".tab-link").on("click", function (b) { var a = $$(this).attr("data-href"); mainView.router.load({ url: a, animatePages: false }); $(this).addClass("active").siblings().removeClass("active") }); refresh_userpanel(); refresh_home(); var ptrContent = $$("#home-refresh"); ptrContent.on("refresh", function (a) { setTimeout(refresh_home, 500) }); wx.config({ debug: false, appId: $("#appId").text(), timestamp: $("#timeStamp").text(), nonceStr: $("#nonce").text(), signature: $("#signature").text(), jsApiList: ["uploadImage", "downloadImage", "chooseImage", "getLocation", "previewImage", "openLocation"] }); $$(document).on("touchstart", "a.random-param", function () { var a = $$(this).attr("href") + "&rand=" + Math.random() * 500; $$(this).attr("href", a) }); $$("#manager_userpanel").on("click", ".manager-photolist", function () { var a = [{ url: "/Content/images/Manager_app_01.jpg", caption: "督导签到 - - 首页" }, { url: "/Content/images/Manager_app_03.jpg", caption: "督导签到 - - 首页" }, { url: "/Content/images/Manager_app_02.jpg", caption: "督导签到 - - 督导个人信息" }, { url: "/Content/images/Manager_app_04.jpg", caption: "督导签到 - - 督导每日签到" }, { url: "/Content/images/Manager_app_05.jpg", caption: "督导签到 - - 督导工作日报" }, { url: "/Content/images/Manager_app_06.jpg", caption: "督导签到 - - 查看个人签到信息" }, { url: "/Content/images/Manager_app_07.jpg", caption: "督导签到 - - 查看其他督导签到" }, { url: "/Content/images/Manager_app_08.jpg", caption: "督导签到 - - 店铺提报列表" }, { url: "/Content/images/Manager_app_09.jpg", caption: "督导巡店 - - 首页" }, { url: "/Content/images/Manager_app_10.jpg", caption: "督导巡店 - - 未签到" }, { url: "/Content/images/Manager_app_11.jpg", caption: "督导巡店 - - 未签退" }, { url: "/Content/images/Manager_app_12.jpg", caption: "督导巡店 - - 修改签到信息" }, { url: "/Content/images/Manager_app_13.jpg", caption: "督导管理 - - 首页" }, { url: "/Content/images/Manager_app_14.jpg", caption: "督导管理 - - 销量排名" }, { url: "/Content/images/Manager_app_15.jpg", caption: "督导管理 - - 红包发放" }, { url: "/Content/images/Manager_app_16.jpg", caption: "督导管理 - - 红包记录" }, { url: "/Content/images/Manager_app_17.jpg", caption: "督导暗促 - - 首页" }]; var b = myApp.photoBrowser({ photos: a, theme: "dark", type: "standalone", lazyLoading: true, zoom: false, backLinkText: "关闭" }); b.open() }); $$(document).on("pageInit", ".page[data-page='manager-task']", function (a) { $$.ajax({ url: "/Seller/Manager_RefreshTaskCount", method: "post", success: function (b) { b = JSON.parse(b); if (b.result = "SUCCESS") { $$("#managertask-count").text(b.data) } } }) }); $$(document).on("pageInit", ".page[data-page='manager-task-addcheckin']", function (a) { currentTextAreaLength("manager-task-addcheckin", "Remark", 50, "checkin-currentlength"); uploadCheckinFile("manager-task-addcheckin", "manager-imglist", "Photo", "current_image", 3); uploadLocationWithDetails("location-btn", "Location", "Location_Desc"); $("#addcheckin_form").validate({ debug: false, errorClass: "custom-error", focusInvalid: false, onkeyup: false, submitHandler: function (b) { var c = splitArray($("#Photo").val()); if (c.length == 0) { myApp.hideIndicator(); myApp.alert("请至少上传一张图片"); $("#addcheckin-btn").prop("disabled", false).removeClass("color-gray") } else { if ($("#Location").val().trim() == "") { myApp.hideIndicator(); myApp.alert("请上传您的地理位置"); $("#addcheckin-btn").prop("disabled", false).removeClass("color-gray") } else { $("#addcheckin_form").ajaxSubmit(function (d) { if (d == "SUCCESS") { myApp.hideIndicator(); mainView.router.back(); myApp.addNotification({ title: "通知", message: "表单提交成功" }); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } else { myApp.hideIndicator(); myApp.addNotification({ title: "通知", message: "表单提交失败" }); $("#addcheckin-btn").prop("disabled", false).removeClass("color-gray"); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } }) } } }, errorPlacement: function (b, c) { myApp.hideIndicator(); $("#addcheckin-btn").prop("disabled", false).removeClass("color-gray"); c.attr("placeholder", b.text()) } }); $$("#addcheckin-btn").click(function () { myApp.showIndicator(); $("#addcheckin-btn").prop("disabled", true).addClass("color-gray"); setTimeout(function () { $("#addcheckin_form").submit() }, 500) }) }); myApp.onPageBack("manager-task-addcheckin", function () { $$.ajax({ url: "/Seller/Manager_RefreshTaskCount", method: "post", success: function (a) { a = JSON.parse(a); if (a.result = "SUCCESS") { $$("#managertask-count").text(a.data) } } }) }); $$(document).on("pageInit", ".page[data-page='manager-task-report']", function () { $$.ajax({ url: "/Seller/Manager_TaskReportPartial", data: { id: $$("#taskreport-date").val() }, success: function (a) { $("#task_details").html(a); currentTextAreaLength("manager-task-report", "Event_Complete", 500, "tasklength-cp"); currentTextAreaLength("manager-task-report", "Event_UnComplete", 500, "tasklength-uc"); currentTextAreaLength("manager-task-report", "Event_Assistance", 500, "tasklength-as"); uploadCheckinFile("manager-task-report", "manager-imglist", "Photo", "current_image", 7) } }); $$("#taskreport-date").on("change", function () { $$.ajax({ url: "/Seller/Manager_TaskReportPartial", data: { id: $$("#taskreport-date").val() }, success: function (a) { $("#task_details").html(a); currentTextAreaLength("manager-task-report", "Event_Complete", 500, "tasklength-cp"); currentTextAreaLength("manager-task-report", "Event_UnComplete", 500, "tasklength-uc"); currentTextAreaLength("manager-task-report", "Event_Assistance", 500, "tasklength-as"); uploadCheckinFile("manager-task-report", "manager-imglist", "Photo", "current_image", 7) } }) }); $$("#task_details").on("click", "#report-submit-btn", function () { $("#report-submit-btn").prop("disabled", true).addClass("color-gray"); myApp.showIndicator(); setTimeout(function () { myApp.hideIndicator() }, 5000); setTimeout(function () { $("#managerreport-form").ajaxSubmit({ success: function (a) { if (a == "SUCCESS") { myApp.hideIndicator(); mainView.router.back(); myApp.addNotification({ title: "通知", message: "日报修改成功" }); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } else { myApp.hideIndicator(); $("#report-submit-btn").prop("disabled", true).addClass("color-gray"); myApp.addNotification({ title: "通知", message: "日报修改失败" }); $("#task_details").html(a); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } } }) }, 500) }) }); $$(document).on("pageInit", ".page[data-page='manager-checkinview']", function () { $$.ajax({ url: "/Seller/Manager_CheckInViewPartial", data: { id: $$(".check-date").val() }, success: function (a) { $$(".list-content").html(a) } }); $$(".check-date").on("change", function () { $$.ajax({ url: "/Seller/Manager_CheckInViewPartial", data: { id: $$(".check-date").val() }, success: function (a) { $$(".list-content").html(a) } }) }); $$(".list-content").on("deleted", ".swipeout", function (c) { var b = "/Seller/Mananger_CancelManagerCheckin"; var a = $$(c.target).attr("data-url"); swipe_deleted(b, a) }); PhotoBrowser("manager-checkinview-content") }); myApp.onPageBack("manager-checkinview", function (a) { $$.ajax({ url: "/Seller/Manager_RefreshTaskCount", method: "post", success: function (b) { b = JSON.parse(b); if (b.result = "SUCCESS") { $$("#managertask-count").text(b.data) } } }) }); $$(document).on("pageInit", ".page[data-page='manager-allchekinlist']", function () { var a = $$("#task_id").val(); $$.ajax({ url: "/Seller/Senior_AllCheckInListPartial", data: { date: a }, success: function (b) { $$("#allcheckinlist-content").html(b) } }); $$("#task_id").on("change", function () { var b = $$("#task_id").val(); $$.ajax({ url: "/Seller/Senior_AllCheckInListPartial", data: { date: b }, success: function (c) { $$("#allcheckinlist-content").html(c) } }) }) }); $$(document).on("pageInit", ".page[data-page='manager-request-list']", function () { $$.ajax({ url: "/Seller/Manager_RequestListPartial", success: function (a) { $$("#manager-requestlist").html(a) } }); $$("#manager-requestlist").on("deleted", ".swipeout", function (a) { $$.ajax({ url: "Manager_CancelRequestJson", data: { id: $$(a.target).attr("data-url") }, method: "post", success: function (b) { b = JSON.parse(b); if (b.result != "SUCCESS") { myApp.alert("删除失败") } } }) }) }); $$(document).on("pageInit", ".page[data-page='manager-task-requestcreate']", function () { currentTextAreaLength("manager-task-requestcreate", "RequestContent", 500, "requestcontent_length"); $("#requestcreate-form").validate({ debug: false, errorClass: "custom-error", focusInvalid: false, onkeyup: false, submitHandler: function (a) { $("#requestcreate-form").ajaxSubmit(function (b) { if (b == "SUCCESS") { myApp.hideIndicator(); mainView.router.back(); myApp.addNotification({ title: "通知", message: "表单提交成功" }); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } else { myApp.hideIndicator(); myApp.addNotification({ title: "通知", message: "表单提交失败" }); $("#requestcreate-btn").prop("disabled", false).removeClass("color-gray"); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } }) }, rules: { RequestContent: { required: true, maxlength: 500 }, RequestRemark: { required: true, maxlength: 20 } }, messages: { RequestContent: { required: "字段不能为空", maxlength: jQuery.format("不能小于{0}个字符") }, RequestRemark: { required: "字段不能为空", maxlength: jQuery.format("不能小于{0}个字符") } }, errorPlacement: function (a, b) { myApp.hideIndicator(); $("#requestcreate-btn").prop("disabled", false).removeClass("color-gray"); b.attr("placeholder", a.text()) } }); $$("#requestcreate-btn").click(function () { myApp.showIndicator(); $("#requestcreate-btn").prop("disabled", true).addClass("color-gray"); setTimeout(function () { $("#requestcreate-form").submit() }, 500) }) }); $$(document).on("pageInit", ".page[data-page='manager-task-requestedit']", function () { currentTextAreaLength("manager-task-requestedit", "RequestContent", 500, "requestcontent_length"); $("#requestedit-form").validate({ debug: false, errorClass: "custom-error", focusInvalid: false, onkeyup: false, submitHandler: function (a) { $("#requestedit-form").ajaxSubmit(function (b) { if (b == "SUCCESS") { myApp.hideIndicator(); mainView.router.back(); myApp.addNotification({ title: "通知", message: "表单提交成功" }); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } else { myApp.hideIndicator(); myApp.addNotification({ title: "通知", message: "表单提交失败" }); $("#requestedit-btn").prop("disabled", false).removeClass("color-gray").show(); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } }) }, rules: { RequestContent: { required: true, maxlength: 500 }, RequestRemark: { required: true, maxlength: 20 } }, messages: { RequestContent: { required: "字段不能为空", maxlength: jQuery.format("不能小于{0}个字符") }, RequestRemark: { required: "字段不能为空", maxlength: jQuery.format("不能小于{0}个字符") } }, errorPlacement: function (a, b) { myApp.hideIndicator(); $("#requestedit-btn").prop("disabled", false).removeClass("color-gray").show(); b.attr("placeholder", a.text()) } }); $$("#requestedit-btn").click(function () { myApp.showIndicator(); $("#requestedit-btn").prop("disabled", true).addClass("color-gray"); setTimeout(function () { $("#requestedit-form").submit() }, 500) }) }); $$(document).on("pageInit", ".page[data-page='manager-checkindetails']", function () { PhotoBrowser("manager-checkindetails"); LocationBrowser("manager-checkindetails") }); $$(document).on("pageInit", ".page[data-page='manager-home']", function () { refresh_home(); var a = $$("#home-refresh"); a.on("refresh", function (b) { setTimeout(refresh_home, 500) }) }); $$(document).on("pageAfterAnimation", ".page[data-page='manager-uncheckinlist']", function () { var a = "/Seller/Manager_UnCheckInListPartial"; datepicker_refresh(a) }); myApp.onPageBack("manager-uncheckinlist", function (b) { var a = $$("#home-refresh"); myApp.pullToRefreshTrigger(a) }); $$(document).on("pageAfterAnimation", ".page[data-page='manager-uncheckoutlist']", function () { var a = "/Seller/Manager_UnCheckOutListPartial"; datepicker_refresh(a); $$(".list-content").on("deleted", ".swipeout", function (d) { var c = "/Seller/Manager_DeleteCheckIn"; var b = $$(d.target).attr("data-url"); swipe_deleted(c, b) }) }); myApp.onPageBack("manager-uncheckoutlist", function (b) { var a = $$("#home-refresh"); myApp.pullToRefreshTrigger(a) }); $$(document).on("pageAfterAnimation", ".page[data-page='manager-unreportlist']", function () { var a = "/Seller/Manager_UnReportListPartial"; datepicker_refresh(a); $$(".list-content").on("deleted", ".swipeout", function (d) { var c = "/Seller/Manager_DeleteCheckIn"; var b = $$(d.target).attr("data-url"); swipe_deleted(c, b) }) }); myApp.onPageBack("manager-unreportlist", function (b) { var a = $$("#home-refresh"); myApp.pullToRefreshTrigger(a) }); $$(document).on("pageAfterAnimation", ".page[data-page='manager-unconfirmlist']", function () { var a = "/Seller/Manager_UnConfirmListPartial"; $$.ajax({ url: "/Seller/Manager_UnConfirmListPartial", success: function (b) { $(".list-content").html(b) } }); $$(".list-content").on("deleted", ".swipeout", function (d) { var c = "/Seller/Manager_DeleteCheckIn"; var b = $$(d.target).attr("data-url"); swipe_deleted(c, b) }) }); myApp.onPageBack("manager-unconfirmlist", function (b) { var a = $$("#home-refresh"); myApp.pullToRefreshTrigger(a) }); $$(document).on("pageInit", ".page[data-page='manager-createcheckin']", function () { uploadCheckinFile("checkinphoto-area", "manager-checkin-imglist", "CheckinPhoto", "checkin-current-image", 1); uploadCheckinFile("checkoutphoto-area", "manager-checkout-imglist", "CheckoutPhoto", "checkout-current-image", 1); uploadCheckinFile("reportphoto-area", "manager-report-imglist", "Rep_Image", "report-current-image", 7); currentTextAreaLength("confirmremark-area", "Confirm_Remark", 500, "confirmremark-length"); $("#createcheckin-form").validate({ debug: false, errorClass: "custom-error", focusInvalid: false, onkeyup: false, submitHandler: function (c) { var d = splitArray($("#CheckinPhoto").val()); var b = splitArray($("#CheckoutPhoto").val()); var a = splitArray($("#Rep_Image").val()); if ($$("#Off_Seller_Id").val().trim() == "") { myApp.hideIndicator(); myApp.alert("请选择促销员"); $("#createcheckin-btn").prop("disabled", false).removeClass("color-gray") } else { if (a.length == 0) { myApp.hideIndicator(); myApp.alert("请至少上传一张销量图片"); $("#createcheckin-btn").prop("disabled", false).removeClass("color-gray") } else { $("#createcheckin-form").ajaxSubmit(function (e) { if (e == "SUCCESS") { myApp.hideIndicator(); mainView.router.back(); myApp.addNotification({ title: "通知", message: "表单提交成功" }); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } else { myApp.hideIndicator(); myApp.addNotification({ title: "通知", message: "表单提交失败" }); $("#createcheckin-btn").prop("disabled", false).removeClass("color-gray"); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } }) } } }, rules: { Confirm_Remark: { required: true, maxlength: 500 } }, messages: { Confirm_Remark: { required: "字段不能为空", maxlength: jQuery.format("不能小于{0}个字符") } }, errorPlacement: function (a, b) { myApp.hideIndicator(); $("#createcheckin-btn").prop("disabled", false).removeClass("color-gray"); b.attr("placeholder", a.text()) } }); $$("#createcheckin-btn").click(function () { myApp.showIndicator(); $("#createcheckin-btn").prop("disabled", true).addClass("color-gray"); setTimeout(function () { $("#createcheckin-form").submit() }, 500) }) }); $$(document).on("pageInit", ".page[data-page='manager-editcheckin']", function () { uploadCheckinFile("checkinphoto-area", "manager-checkin-imglist", "CheckinPhoto", "checkin-current-image", 1); uploadCheckinFile("checkoutphoto-area", "manager-checkout-imglist", "CheckoutPhoto", "checkout-current-image", 1); uploadCheckinFile("reportphoto-area", "manager-report-imglist", "Rep_Image", "report-current-image", 7); currentTextAreaLength("confirmremark-area", "Confirm_Remark", 500, "confirmremark-length"); $("#editcheckin-form").validate({ debug: false, errorClass: "custom-error", focusInvalid: false, onkeyup: false, submitHandler: function (a) { $("#editcheckin-form").ajaxSubmit(function (b) { if (b == "SUCCESS") { myApp.hideIndicator(); mainView.router.back(); myApp.addNotification({ title: "通知", message: "表单提交成功" }); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } else { myApp.hideIndicator(); myApp.addNotification({ title: "通知", message: "表单提交失败" }); $("#editcheckin-btn").prop("disabled", false).removeClass("color-gray"); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } }) }, rules: { Confirm_Remark: { required: true, maxlength: 500 } }, messages: { Confirm_Remark: { required: "字段不能为空", maxlength: jQuery.format("不能小于{0}个字符") } }, errorPlacement: function (a, b) { myApp.hideIndicator(); $("#editcheckin-btn").prop("disabled", false).removeClass("color-gray"); b.attr("placeholder", a.text()) } }); $$("#editcheckin-btn").click(function () { myApp.showIndicator(); $("#editcheckin-btn").prop("disabled", true).addClass("color-gray"); setTimeout(function () { $("#editcheckin-form").submit() }, 500) }) }); $$(document).on("pageInit", ".page[data-page='manager-checkinconfirm']", function () { PhotoBrowser("checkin-photo-link"); PhotoBrowser("checkout-photo-link"); PhotoBrowser("report-photo-link"); LocationBrowser("checkin-location"); LocationBrowser("checkout-location"); currentTextAreaLength("confirmremark-area", "Confirm_Remark", 500, "confirmremark-length"); $("#checkinconfirm-form").validate({ debug: false, errorClass: "custom-error", focusInvalid: false, onkeyup: false, submitHandler: function (a) { $("#checkinconfirm-form").ajaxSubmit(function (b) { if (b == "SUCCESS") { myApp.hideIndicator(); mainView.router.back(); myApp.addNotification({ title: "通知", message: "表单提交成功" }); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } else { myApp.hideIndicator(); myApp.addNotification({ title: "通知", message: "表单提交失败" }); $("#checkinconfirm-btn").prop("disabled", false).removeClass("color-gray"); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } }) }, rules: { Confirm_Remark: { required: true, maxlength: 500 } }, messages: { Confirm_Remark: { required: "字段不能为空", maxlength: jQuery.format("不能小于{0}个字符") } }, errorPlacement: function (a, b) { myApp.hideIndicator(); $("#checkinconfirm-btn").prop("disabled", false).removeClass("color-gray"); b.attr("placeholder", a.text()) } }); $$("#checkinconfirm-btn").click(function () { myApp.showIndicator(); $("#checkinconfirm-btn").prop("disabled", true).addClass("color-gray"); setTimeout(function () { $("#checkinconfirm-form").submit() }, 500) }) }); $$(document).on("pageInit", ".page[data-page='manager-viewconfirm']", function () { PhotoBrowser("manager-viewconfirm") }); $$(document).on("pageInit", ".page[data-page='manager-reportlist']", function (d) { var c = myApp.calendar({ input: "#manager-reportlist-date", monthNames: monthNames, monthNamesShort: monthNamesShort, dayNames: dayNames, dayNamesShort: dayNamesShort, closeOnSelect: true }); var b = $$("#manager-reportlist-date").val(); var a = $$("#manager-reportlist-storesystem").val(); $$.ajax({ url: "/Seller/Manager_ReportListPartial", data: { date: b, storesystem: a }, success: function (e) { $$("#manager-reportlist-content").html(e) } }); $$("#manager-reportlist-date").on("change", function () { var f = $$("#manager-reportlist-date").val(); var e = $$("#manager-reportlist-storesystem").val(); $$.ajax({ url: "/Seller/Manager_ReportListPartial", data: { date: f, storesystem: e }, success: function (g) { $$("#manager-reportlist-content").html(g) } }) }); $$("#manager-reportlist-storesystem").on("change", function () { var f = $$("#manager-reportlist-date").val(); var e = $$("#manager-reportlist-storesystem").val(); $$.ajax({ url: "/Seller/Manager_ReportListPartial", data: { date: f, storesystem: e }, success: function (g) { $$("#manager-reportlist-content").html(g) } }) }) }); $$(document).on("pageInit", ".page[data-page='manager-tasksellerdetails']", function () { var b = myApp.photoBrowser({ photos: ["/Content/images/guide-02-3.jpg"], theme: "dark", type: "standalone", lazyLoading: true, zoom: false, backLinkText: "关闭" }); var a = myApp.photoBrowser({ photos: ["/Content/images/guide-02-2.jpg"], theme: "dark", type: "standalone", lazyLoading: true, zoom: false, backLinkText: "关闭" }); var c = myApp.photoBrowser({ photos: ["/Content/images/guide-02-3.jpg"], theme: "dark", type: "standalone", lazyLoading: true, zoom: false, backLinkText: "关闭" }); $$(".manager-tasksellerdetails-checkin").on("click", function () { b.open() }); $$(".manager-tasksellerdetails-checkout").on("click", function () { a.open() }); $$(".manager-tasksellerdetails-sales").on("click", function () { c.open() }) }); $$(document).on("pageInit", ".page[data-page='manager-bonusremark']", function () { currentTextAreaLength("manager-bonusremark", "Bonus_Remark", 100, "confirmremark_length"); $("#bonusremark-form").validate({ debug: false, errorClass: "custom-error", focusInvalid: false, onkeyup: false, submitHandler: function (a) { $("#bonusremark-form").ajaxSubmit(function (b) { if (b == "SUCCESS") { myApp.hideIndicator(); mainView.router.back(); myApp.addNotification({ title: "通知", message: "表单提交成功" }); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } else { myApp.hideIndicator(); myApp.addNotification({ title: "通知", message: "表单提交失败" }); $("#bonusremark-btn").prop("disabled", false).removeClass("color-gray"); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } }) }, rules: { Bonus: { required: true, range: [5, 200] }, BonusRemark: { required: true, maxlength: 100 } }, messages: { Bonus: { required: "字段不能为空", range: jQuery.format("请输入一个介于 {0} 和 {1} 之间的值") }, RequestRemark: { required: "字段不能为空", maxlength: jQuery.format("不能大于{0}个字符") } }, errorPlacement: function (a, b) { myApp.hideIndicator(); $("#bonusremark-btn").prop("disabled", false).removeClass("color-gray"); b.attr("placeholder", a.text()) } }); $$("#bonusremark-btn").click(function () { myApp.showIndicator(); $("#bonusremark-btn").prop("disabled", true).addClass("color-gray"); setTimeout(function () { $("#bonusremark-form").submit() }, 500) }) }); $$(document).on("pageInit", ".page[data-page='manager-eventlist']", function (d) { var c = myApp.calendar({ input: "#manager-eventlist-date", monthNames: monthNames, monthNamesShort: monthNamesShort, dayNames: dayNames, dayNamesShort: dayNamesShort, closeOnSelect: true }); var b = "/Seller/Manager_EventListPartial"; var a = $$("#manager-eventlist-date").val(); $$.ajax({ url: b, data: { date: a }, success: function (e) { $$("#manager-eventlist-content").html(e) } }); $$("#manager-eventlist-date").on("change", function () { var e = $$("#manager-eventlist-date").val(); $$.ajax({ url: "/Seller/Manager_EventListPartial", data: { date: e }, success: function (f) { $$("#manager-eventlist-content").html(f) } }) }) }); $$(document).on("pageInit", ".page[data-page='manager-queryseller']", function () { var a = myApp.searchbar(".searchbar", { searchList: ".list-block-search", searchIn: ".item-content" }) }); $$(document).on("pageInit", ".page[data-page='manager-editsellerinfo']", function () { $("#editsellerinfo-form").validate({ debug: false, errorClass: "custom-error", focusInvalid: false, onkeyup: false, submitHandler: function (a) { $("#editsellerinfo-form").ajaxSubmit(function (b) { if (b == "SUCCESS") { myApp.hideIndicator(); mainView.router.back(); myApp.addNotification({ title: "通知", message: "表单提交成功" }); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } else { myApp.hideIndicator(); myApp.addNotification({ title: "通知", message: "表单提交失败" }); $("#editsellerinfo-btn").prop("disabled", false).removeClass("color-gray"); setTimeout(function () { myApp.closeNotification(".notifications") }, 2000) } }) }, rules: { IdNumber: { required: true, idnumber: true }, AccountSource: { required: true, maxlength: 50 }, AccountName: { required: true, maxlength: 10 }, CardNo: { required: true, maxlength: 30 }, StandardSalary: { range: [0, 500] } }, messages: { IdNumber: { required: "必填", idnumber: "请正确填写身份证号码" }, AccountSource: { required: "必填", maxlength: jQuery.format("不能大于{0}个字符") }, AccountName: { required: "必填", maxlength: jQuery.format("不能大于{0}个字符") }, CardNo: { required: "必填", maxlength: jQuery.format("不能大于{0}个字符") }, StandardSalary: { range: jQuery.format("请输入一个介于 {0} 和 {1} 之间的值") } }, errorPlacement: function (a, b) { myApp.hideIndicator(); $("#editsellerinfo-btn").prop("disabled", false).removeClass("color-gray"); b.attr("placeholder", a.text()) } }); $$("#editsellerinfo-btn").click(function () { myApp.showIndicator(); $("#editsellerinfo-btn").prop("disabled", true).addClass("color-gray"); setTimeout(function () { $("#editsellerinfo-form").submit() }, 500) }) }); $$(document).on("pageInit", ".page[data-page='manager-storelist']", function () { var a = myApp.searchbar(".searchbar", { searchList: ".list-block-search", searchIn: ".item-content" }) }); $$(document).on("pageInit", ".page[data-page='manager-bonuslist']", function () { $$.ajax({ url: "/Seller/Manager_BonusList_HistoryPartial", success: function (b) { $$("#history-content").html(b) } }); $$.ajax({ url: "/Seller/Manager_BonusList_UnSendPartial", success: function (b) { $$("#bonus-content").html(b) } }); $$("#bonus-content").on("deleted", ".swipeout", function (b) { $$.ajax({ url: "/Seller/Manager_BonusDismiss", data: { id: $$(b.target).attr("data-url") }, method: "post", success: function (c) { c = JSON.parse(c); if (c.result != "SUCCESS") { myApp.alert("删除失败") } } }) }); $$("#bonus-content").on("click", ".confirmbonus", function (c) { var b = $$(this).attr("data-url"); myApp.confirm("是否确认发放红包?", function () { $$.ajax({ url: "/Seller/Manager_BonusConfirm", data: { id: b }, method: "post", success: function (d) { d = JSON.parse(d); if (d.result == "SUCCESS") { $$.ajax({ url: "/Seller/Manager_BonusList_UnSendPartial", success: function (e) { $$("#bonus-content").html(e) } }) } else { myApp.alert("红包发放失败") } } }) }) }); var a = $$(".pull-to-refresh-content"); a.on("refresh", function (b) { setTimeout(function () { $$.ajax({ url: "/Seller/Manager_BonusList_HistoryRefresh", method: "post", success: function (d) { var c = JSON.parse(d); if (c.result == "SUCCESS") { $$.ajax({ url: "/Seller/Manager_BonusList_HistoryPartial", success: function (e) { $$("#history-content").html(e) } }) } } }); myApp.pullToRefreshDone() }, 2000) }) }); $$(document).on("pageInit", ".page[data-page='manager-storelist']", function () { $$(".store_details").click(function () { var a = $$(this); $.ajax({ url: "http://apis.map.qq.com/ws/coord/v1/translate", type: "get", dataType: "jsonp", data: { locations: $$(this).attr("data-latitude") + "," + $$(this).attr("data-longitude"), type: 3, output: "jsonp", key: "FAKBZ-YPIW4-TOLUE-XLQOL-MAYZQ-3FFGF" }, success: function (b) { if (b.status == 0) { wx.openLocation({ latitude: b.locations[0].lat, longitude: b.locations[0].lng, name: a.attr("data-storename"), address: a.attr("data-address"), scale: 25, infoUrl: "" }) } } }) }) }); $$(document).on("pageInit", ".page[data-page='manager-tempsellerdetails']", function () { var a = $("#sellertask-details-phlist").val().split(","); var b = new Array(); $$.each(a, function (e, g) { var d = "http://cdn2.shouquanzhai.cn/checkin-img/" + g; var f = { url: d }; b.push(f) }); var c = myApp.photoBrowser({ photos: b, theme: "dark", type: "standalone", lazyLoading: true, zoom: false, backLinkText: "关闭" }); $$(".ph-tempseller").on("click", function (d) { c.open() }) }); $$(document).on("pageInit", ".page[data-page='manager-sellertask-month']", function () { $$.ajax({ url: "/Seller/ManagerSellerTaskMonthStatisticPartial", data: { querydate: $("#statistic-month").val() }, success: function (a) { $$("#manager-seller-taskmonth").html(a) } }); $("#statistic-month").on("change", function (a) { $$.ajax({ url: "/Seller/ManagerSellerTaskMonthStatisticPartial", data: { querydate: $("#statistic-month").val() }, success: function (b) { $$("#manager-seller-taskmonth").html(b) } }) }) }); $$(document).on("pageInit", ".page[data-page='managerseller-taskdate']", function () { var b = 1; var a = "/Seller/ManagerSellerTaskSellerPartial"; $$.ajax({ url: a, data: { page: b, id: $("#sellerid").val() }, success: function (d) { if (d != "FAIL") { $$("#managerseller-list").html(d); b++ } } }); var c = false; $$(".infinite-scroll").on("infinite", function (d) { $$(".infinite-scroll-preloader").removeClass("hidden"); if (c) { return } c = true; setTimeout(function () { c = false; $$.ajax({ url: a, data: { page: b, id: $("#sellerid").val() }, success: function (e) { if (e == "NONE" || e == "FAIL") { myApp.detachInfiniteScroll($$(".infinite-scroll")); $$(".infinite-scroll-preloader").remove(); $$(".infinite-pre").removeClass("hidden"); return } else { $$("#managerseller-list").append(e); b++ } } }) }, 1000) }) }); $$(document).on("pageInit", ".page[data-page='managersellertask-query']", function () { var a = myApp.searchbar(".searchbar", { searchList: ".list-block-search", searchIn: ".item-content" }) }); function refresh_userpanel() { $$.ajax({ url: "/Seller/Manager_UserPanel", success: function (a) { if (a != "Error") { $$("#manager_userpanel").html(a) } } }) } function currentTextAreaLength(d, a, e, c) { var b = $$("#" + a).val().length; $$("#" + c).text(b); $$("#" + d).on("change", "#" + a, function () { var f = $$("#" + a).val().length; if (f < e) { $$("#" + c).text(f) } else { myApp.alert("已超出最大值，请重新填写或删除部分信息"); var g = $$("#" + a).val(); $$("#" + a).val(g.slice(0, 50)); $$("#" + c).text("50") } }) } function uploadCheckinFile(c, a, e, b, f) { $$("#" + a).html(""); var g = splitArray($$("#" + e).val()); $$("#" + b).text(g.length); for (var d = 0; d < g.length; d++) { $$("#" + a).append('<li><div class="rep-imgitem" data-rel=\'' + g[d] + "' style=\"background-image:url(/Seller/ThumbnailImage?filename=" + g[d] + '); background-size:cover"></div></li>') } $$("#" + a).append('<li><a href="javascript:;" class="rep-imgitem-btn" id="' + a + '-upload-btn"><i class="fa fa-plus"></i></a></li>'); $$("#" + a).on("click", "#" + a + "-upload-btn", function (i) { var h; var j = splitArray($("#" + e).val()); if (j.length < f) { wx.chooseImage({ count: 1, sizeType: ["compressed"], sourceType: ["album", "camera"], success: function (k) { h = k.localIds; wx.uploadImage({ localId: h[0], isShowProgressTips: 1, success: function (m) { var l = m.serverId; $$.ajax({ url: "/Seller/SaveOrignalImage", type: "post", data: { serverId: l }, success: function (o) { data = JSON.parse(o); if (data.result == "SUCCESS") { $$("#" + a).html(""); j.push(data.filename); $$("#" + b).text(j.length); $$("#" + e).val(j.toString()); for (var n = 0; n < j.length; n++) { $$("#" + a).append('<li><div class="rep-imgitem" data-rel=\'' + j[n] + "' style=\"background-image:url(/Seller/ThumbnailImage?filename=" + j[n] + '); background-size:cover"></div></li>') } $$("#" + a).append('<li><a href="javascript:;" class="rep-imgitem-btn" id="' + a + '-upload-btn"><i class="fa fa-plus"></i></a></li>') } else { myApp.alert("上传失败，请重试") } } }) } }) } }) } else { myApp.alert("上传图片不得大于" + f + "张，无法添加") } }); $$("#" + a).on("click", ".rep-imgitem", function (i) { var h = $$(this); $$(".rep-imgitem").each(function () { $$(this).html("") }); h.html("<div class='rep-imgitem-selected'><i class='fa fa-minus'></i></div>") }); $$("#" + a).on("click", ".rep-imgitem-selected", function () { myApp.confirm("是否确认删除已上传图片?", "提示", function () { var k = $(".rep-imgitem-selected").closest(".rep-imgitem").attr("data-rel"); var j = splitArray($("#" + e).val()); var l = $.inArray(k, j); j.splice(l, 1); $$("#" + e).val(j.toString()); $$("#" + b).text(j.length); $$("#" + a).html(""); for (var h = 0; h < j.length; h++) { $("#" + a).append('<li><div class="rep-imgitem" data-rel=\'' + j[h] + "' style=\"background-image:url(/Seller/ThumbnailImage?filename=" + j[h] + '); background-size:cover"></div></li>') } $$("#" + a).append('<li><a href="javascript:;" class="rep-imgitem-btn" id="' + a + '-upload-btn"><i class="fa fa-plus"></i></a></li>') }) }) } function uploadLocation(b, a) { $$("#" + b).on("click", function () { myApp.showIndicator(); setTimeout(function () { if (!c) { myApp.hideIndicator(); myApp.alert("获取位置失败") } }, 4000); var c = false; wx.getLocation({ type: "wgs84", success: function (e) { var i = e.latitude; var g = e.longitude; var f = e.speed; var h = e.accuracy; var d = g + "," + i; c = true; $$("#" + b).find(".item-after").text("上传位置成功"); $$("#" + a).val(d); myApp.hideIndicator() } }); return false }) } function uploadLocationWithDetails(c, b, a) { $$("#" + c).on("click", function () { myApp.showIndicator(); setTimeout(function () { if (!d) { myApp.hideIndicator(); myApp.alert("获取位置失败") } }, 4000); var d = false; wx.getLocation({ type: "wgs84", success: function (g) { var k = g.latitude; var i = g.longitude; var h = g.speed; var j = g.accuracy; var e = i + "," + k; d = true; $$("#" + c).find(".item-after").text("上传位置成功"); $$("#" + b).val(e); var f = k + "," + i; $.ajax({ url: "http://apis.map.qq.com/ws/coord/v1/translate", method: "get", dataType: "jsonp", data: { locations: f, type: 1, output: "jsonp", key: "FAKBZ-YPIW4-TOLUE-XLQOL-MAYZQ-3FFGF" }, success: function (l) { if (l.status == 0) { geocoder = new qq.maps.Geocoder({ complete: function (n) { $("#" + a).val(n.detail.address) } }); var m = new qq.maps.LatLng(l.locations[0].lat, l.locations[0].lng); geocoder.getAddress(m); myApp.hideIndicator() } } }) } }); return false }) } function PhotoBrowser(a) { $$("#" + a).on("click", ".checkin-photos", function () { var d = $(this).attr("data-photos"); if (d.trim() != "") { var b = d.split(","); for (var c = 0; c < b.length; c++) { b[c] = "http://cdn2.shouquanzhai.cn/checkin-img/" + b[c] } wx.previewImage({ current: b[0], urls: b }) } else { myApp.alert("没有找到图片") } }) } function LocationBrowser(a) { $$("#" + a).on("click", ".checkin-lbs", function () { var b = $$(this).attr("data-location").split(","); var c = b[1] + "," + b[0]; var d = $$(this).attr("data-desc"); $.ajax({ url: "http://apis.map.qq.com/ws/coord/v1/translate", type: "get", dataType: "jsonp", data: { locations: c, type: 1, output: "jsonp", key: "FAKBZ-YPIW4-TOLUE-XLQOL-MAYZQ-3FFGF" }, success: function (e) { if (e.status == 0) { wx.openLocation({ latitude: e.locations[0].lat, longitude: e.locations[0].lng, name: "位置信息", address: d, scale: 25, infoUrl: "" }) } } }) }) } function splitArray(b) { var a = new Array(); if (b != null) { if (b.trim() != "") { a = b.trim().split(","); return a } } return a } function datepicker_refresh(c) { var b = myApp.calendar({ input: ".check-date", monthNames: monthNames, monthNamesShort: monthNamesShort, dayNames: dayNames, dayNamesShort: dayNamesShort, closeOnSelect: true }); var a = $$(".check-date").val(); $$.ajax({ url: c, data: { date: a }, success: function (d) { $$(".list-content").html(d) } }); $$(".check-date").on("change", function () { var d = $$(".check-date").val(); $$.ajax({ url: c, data: { date: d }, success: function (e) { $$(".list-content").html(e) } }) }) } function swipe_deleted(b, a) { $$.ajax({ url: b, method: "POST", data: { id: a }, success: function (c) { var d = JSON.parse(c); if (d.result == "SUCCESS") { } else { myApp.alert("删除失败") } } }) } function refresh_home() { $$.ajax({ url: "/Seller/Manager_RefreshAllCount", method: "post", success: function (b) { b = JSON.parse(b); if (b.result == "SUCCESS") { var a = b.data; $$("#uncheckin-count").text(a.uncheckin); $$("#uncheckout-count").text(a.uncheckout); $$("#unreport-count").text(a.unreport); $$("#unconfirm-count").text(a.unconfirm) } else { $$("#uncheckin-count").text("N/A"); $$("#uncheckout-count").text("N/A"); $$("#unreport-count").text("N/A"); $$("#unconfirm-count").text("N/A") } myApp.pullToRefreshDone() } }) };
