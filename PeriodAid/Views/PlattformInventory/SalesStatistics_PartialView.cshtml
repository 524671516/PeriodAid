@model PagedList.IPagedList<PeriodAid.Models.SS_SalesStatistic>
@using PagedList.Mvc;
<table class="table table-hover">
    <thead>
        <tr>
            <th>系统编码</th>
            <th>产品名称</th>
            <th><a href="#" style="display:inline-block;width:100%;height:100%;position:relative" class="sales_sort" data-val="1">前1天销量<i class="fa sort_i" data-sort="dec" style="position:absolute;right:0;top:2px"></i></a></th>
            <th><a href="#" style="display:inline-block;width:100%;height:100%;position:relative" class="sales_sort" data-val="2">近7天销量<i class="fa sort_i" data-sort="dec"  style="position:absolute;right:0;top:2px"></i></a></th>
            <th><a href="#" style="display:inline-block;width:100%;height:100%;position:relative" class="sales_sort" data-val="3">前7天销量<i class="fa sort_i" data-sort="dec"  style="position:absolute;right:0;top:2px"></i></a></th>
            <th>增比</th>
            <th></th>
        </tr>
    </thead>
    <tbody id="sort_partialView">
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.SS_Product.System_Code</td>
                <td>@item.SS_Product.Item_Name</td>
                <td>@item.SingeleDay_Count</td>
                <td>@item.Recent_Count</td>
                <td>@item.Last_Count</td>
                @if (item.Last_Count != 0)
                {
                    <td>@Math.Round(((decimal)item.Recent_Count / item.Last_Count), 4).ToString("p2")</td>
                }
                else
                {
                    <td>0</td>
                }
                <td>
                    <span class="JD-product">@Html.ActionLink("数据统计", "ViewProductStatistic", new { productId = item.Id })</span>&nbsp;|&nbsp;
                    <a class="JD-Traffic" data-val="@item.Id" data-name="@item.SS_Product.Item_Name" style="cursor:pointer">来源分析</a>
                </td>
            </tr>
        }
    </tbody>
</table>
    <div class="text-right">@Html.PagedListPager(Model, page => Url.Action("SalesStatistics_PartialView", new { page }))</div>
<script>
    $(".pagination > li > a").click(function () {
        var l = $(this).attr("href");
        $.ajax({
            url: l,
            data: {
                plattformId: $("#ul_view").children(".active").children(".shop_select").attr("data-id"),
                query: $("#sales_product_query").val(),
                sortVal: $(".sort_i").eq(0).attr("data-sort")
            },
            success: function (data) {
                $("#salesstatistics_list_content").html(data);
            }
        });
        return false;
    });
    // 排序
    $(".sales_sort").on("click", function () {
        var that = $(this)
        if (that.children(".sort_i").hasClass("fa-arrow-up")) {
            $(".sort_i").removeClass("fa-arrow-up fa-arrow-down")
            that.children(".sort_i").removeClass("fa-arrow-up color-red")
            that.children(".sort_i").addClass("fa-arrow-down color-blue")
            that.children(".sort_i").attr("data-sort", "dec")
            $.ajax({
                url: "/PlattformInventory/SalesStatistics_PartialView",
                data: {
                    plattformId: $("#ul_view").children(".active").children(".shop_select").attr("data-id"),
                    query: $("#sales_product_query").val(),
                    sortVal: that.children(".sort_i").attr("data-sort")
                },
                success: function (data) {
                    $("#salesstatistics_list_content").html(data);
                }
            })
        }
        else {
            $(".sort_i").removeClass("fa-arrow-up fa-arrow-down")
            that.children(".sort_i").removeClass("fa-arrow-down color-blue")
            that.children(".sort_i").addClass("fa-arrow-up color-red")
            that.children(".sort_i").attr("data-sort", "asc")
            $.ajax({
                url: "/PlattformInventory/SalesStatistics_PartialView",
                data: {
                    plattformId: $("#ul_view").children(".active").children(".shop_select").attr("data-id"),
                    query: $("#sales_product_query").val(),
                    sortVal: that.children(".sort_i").attr("data-sort")
                },
                success: function (data) {
                    $("#salesstatistics_list_content").html(data);
                }
            })
        }
        return false;
    })
    // 来源分析
    $(".JD-Traffic").on("click", function () {
        var product_Id = $(this).attr('data-val')
        var product_Name = $(this).attr("data-name")
        $(this).attr("href", "TrafficList?plattformId=" + getUrlParam('plattformId') + "&productId=" + product_Id)
    })
</script>