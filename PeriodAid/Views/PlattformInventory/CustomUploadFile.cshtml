@model IEnumerable<PeriodAid.Models.SS_UploadRecord>
@{
    ViewBag.Title = "CustomUploadFile";
    Layout = "~/Views/Shared/_PlattformInventory.cshtml";
}

<input type="hidden" id="plattformId" value="@ViewBag.PlattformId" />
<div id="tm-calendar-view">
    <div class="tm-calendar-view tm-view" style="display:block;position: relative;top:0;height: 521px;width: 960px;">
        <div class="tm-view-header tm-calendar-view-header">
            <div class="tm-view-header-select">
                @*<span class="tm-view-calendar-task-num" id="tm-view-calendar-task-num" style="padding:0 8px 0 0 "><span>上传总数:</span>&nbsp;<strong>12</strong></span>&nbsp;*@
                <form id="excel-form" enctype="multipart/form-data">
                    <a href="#" id="rel_excel_in" class="tm-view-calendar-btn">
                        <span onclick="$('#excel_in').click();">导入Excel文件</span>
                        <input type="file" name="fileName" id="excel_in" style="display:none" />
                    </a>
                    <a href="#" id="rel_excel_sub" class="tm-view-calendar-btn">
                        <span onclick="$('#excel_sub').click();">确认提交</span>
                        <input type="button" name="submit" id="excel_sub" style="display:none" />
                    </a>
                </form>
                 
            </div>

            <div class="tm-calendar-view-control tm-view-control">
                <a href="javascript:;" class="tm-calendar-view-control tm-calendar-prev"><span class="glyphicon glyphicon-chevron-left"></span></a>
                <span class="tm-calendar-view-control tm-calendar-currentmonth color-blue">@Html.Encode(DateTime.Now.ToString("yyyy-MM"))</span>
                <a href="javascript:;" class="tm-calendar-view-control tm-calendar-next"><span class="glyphicon glyphicon-chevron-right"></span></a>
            </div>
        </div>
        <div class="tm-view-content tm-calendar-view-content">
            <div class="tm-view-content-wrap  tm-view-wrap tm-calendar-view-wrap" id="tm-calendar-view-wrap">
            </div>
        </div>

    </div>
</div>

 <script>

         // 初始化日历
         TmDatePicker.Init({
             container: "#tm-calendar-view-wrap",
             onpagechanged: function (e) {
             }
         });
         var nowDate=function(){
             var mydate = new Date();
             var str = "" + mydate.getFullYear() + '-';
             str += (mydate.getMonth() + 1) + "-";
             str += 1;
             return str;
         }
     console.log(nowDate())
         $.ajax({
             url: "/PlattformInventory/CustomUploadFilePartial",
             type: "post",
             data: {
                 plattformId: 1,
                 month: nowDate()
             },
             success: function (data) {
                 console.log(data)
                 var dataDate = $('.tm-calendar-monthofdate')
                 for (var i = 0; i < dataDate.length; i++) {
                     var nowDate = dataDate.eq(i).attr('date-day');
                     for (var j = 0; j < data.length; j++) {
                         record = data[j].record_date.ToString("yyyy-MM-dd");
                         if (record == nowDate) {
                             dataDate.eq(i).parent().addClass('glyphicon glyphicon-star')
                         }
                     }

                 }
             },
             error: function () {
                 ErrorAlert("请求数据失败。");
             }
         });


         $('.glyphicon.glyphicon-chevron-left').on('click', function () {
         $.ajax({
             url: "/PlattformInventory/CustomUploadFilePartial",
             type: "post",
             data: {
                 plattformId: 1,
                 month: nowDate()
             },
             success: function (data) {
                 var dataDate = $('.tm-calendar-monthofdate')
                 for (var i = 0; i < dataDate.length; i++) {
                     var nowDate = dataDate.eq(i).attr('date-day');
                     for (var j = 0; j < data.length; j++) {
                         record = data[j].record_date.ToString("yyyy-MM-dd");
                         if (record == nowDate) {
                             dataDate.eq(i).parent().addClass('glyphicon glyphicon-star')
                         }
                     }

                 }
             },
             error: function () {
                 ErrorAlert("请求数据失败。");
             }
         });
     });
         $('.glyphicon.glyphicon-chevron-right').on('click', function () {
             var futureDate = $('.tm-calendar-view-control.tm-calendar-currentmonth.color-blue').text()
             console.log(futureDate)
         $.ajax({
             url: "/PlattformInventory/CustomUploadFilePartial",
             type: "post",
             data: {
                 plattformId: 1,
                 month: nowDate()
             },
             success: function (data) {
                 var dataDate = $('.tm-calendar-monthofdate')
                 for (var i = 0; i < dataDate.length; i++) {
                     var nowDate = dataDate.eq(i).attr('date-day');
                     for (var j = 0; j < data.length; j++) {
                         record = data[j].record_date.ToString("yyyy-MM-dd");
                         if (record == nowDate) {
                             dataDate.eq(i).parent().addClass('glyphicon glyphicon-star')
                         }
                     }

                 }
             },
             error: function () {
                 ErrorAlert("请求数据失败。");
             }
         });
     })
   

     // 重置时间显示格式
     String.prototype.ToString = function (format) {
         var dateTime = new Date(parseInt(this.substring(6, this.length - 2)));
         format = format.replace("yyyy", dateTime.getFullYear());
         format = format.replace("yy", dateTime.getFullYear().toString().substr(2));
         format = format.replace("MM", (dateTime.getMonth() + 1) < 10 ? "0" + (dateTime.getMonth() + 1) : (dateTime.getMonth() + 1))
         format = format.replace("dd", dateTime.getDate() < 10 ? "0" + dateTime.getDate() : dateTime.getDate());
         format = format.replace("hh", dateTime.getHours() < 10 ? "0" + dateTime.getHours() : dateTime.getHours());
         format = format.replace("mm", dateTime.getMinutes());
         format = format.replace("ss", dateTime.getSeconds());
         format = format.replace("ms", dateTime.getMilliseconds())
         return format;
     };

</script>