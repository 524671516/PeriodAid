@model PeriodAid.Models.SP_QuotePrice
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h2>新增报价信息</h2>
</div>
<div class="hidden" id="quotation-num">@ViewBag.Quoted.Quotation_Num</div>
<div class="hidden" id="quoted-id">@ViewBag.Quoted.Id</div>
<div class="hidden" id="quoted-date">@ViewBag.Quoted.Quoted_Date.ToString("yyyy-MM-dd")</div>
<div class="modal-body">
    @using (Html.BeginForm("AddQuotePricrPartial", "SalesProcess", FormMethod.Post, new { @id = "add-quotePrice-form" }))
    {
        @Html.AntiForgeryToken()
        <div class="form-horizontal">
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            <div class="form-group">
                <label class="col-md-2 control-label">产品名称</label>
                <div class="col-md-9">
                    <input id="product-input" type="text" class="span4 form-control" autocomplete="off" name="product-input" />
                    <input type="hidden" id="ProductId" name="Product_Id" />
                    @Html.ValidationMessageFor(model => model.Product_Id, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">价格</label>
                <div class="col-md-9">
                    @Html.EditorFor(model => model.Quote_Price, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Quote_Price, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">报价单号</label>
                <div class="col-md-9">
                    <input id="quoted-input" type="text" class="span4 form-control" autocomplete="off" name="quoted-input" readonly="readonly" />
                    <input type="hidden" id="QuotedId" name="Quoted_Id" />
                    @Html.ValidationMessageFor(model => model.Quoted_Id, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-2">报价日期</label>
                <div class="col-md-9">
                    <input id="date-input" type="text" class="span4 form-control" autocomplete="off" name="date-input" readonly="readonly" />
                    <input type="hidden" id="QuotedDate" name="SP_Quoted.Quoted_Date" />
                    @Html.ValidationMessageFor(model => model.SP_Quoted.Quoted_Date, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-offset-2 col-md-9">
                    <input type="submit" value="新增" class="btn btn-default" id="add-submit" />
                </div>
            </div>

        </div>
    }
</div>
<script>
    $(function () {
        $("#quoted-input").val($("#quotation-num").html())
        $("#QuotedId").val($("#quoted-id").html())
        $("#date-input").val($("#quoted-date").html())
        $("#QuotedDate").val($("#quoted-date").html())
        //产品搜索
        function displayResult(item, val, text) {
            $("#ProductId").val(val);
        }
        $('#product-input').typeahead({
            ajax: {
                url: "/SalesProcess/QueryProduct",
                triggerLength: 1
            },
            itemSelected: displayResult,
            display: 'ProductName',
            val: 'Id'
        });
    })
    $("#add-quotePrice-form").ajaxForm(function (data) {
        if (data == "SUCCESS") {
            $("#myModal").modal('hide')
            $.ajax({
                url: "/SalesProcess/QuotePricrListPartial",
                data: {
                    query: $("#quotePrice-query").val(),
                    quotedId: getUrlParam('quotedId')
                },
                success: function (data) {
                    $("#quotePrice_list_content").html(data)
                    $('.modal-backdrop.in').remove()
                    $('body').removeClass('modal-open')
                }
            });
            alert("添加成功！");
        }
        else if (data == "UNAUTHORIZED") {
            errorAlert("报价已存在！");
        } else {
            errorAlert("添加失败！");
        }
    });
</script>