@model PeriodAid.Models.SP_QuotePrice
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h2>选择报价产品</h2>
</div>
<div class="modal-body" style="padding:0 0 15px">
    <form method="post" enctype="multipart/form-data" id="price_form">
        <table class="table">
            <tr>
                <th></th>
                <th>产品编码</th>
                <th>产品名称</th>
                <th>报价</th>
            </tr>
            @foreach(var item in ViewBag.QuotePrice)
            {
            <tr>
                <td style="text-align:center"><input type="checkbox" data-val="@item.Product_Id" /></td>
                <td>@item.SP_Product.Item_Code</td>
                <td>@item.SP_Product.Item_Name</td>
                <td>@item.Quote_Price</td>
            </tr>
            }
        </table>
        <input value="确认" class="btn btn-danger" style="margin-left:30px" id="price-form-sub"/>
    </form>
</div>
<div class="modal-footer">
</div>
<script>
    $(function () {
        $("#price-form-sub").attr("type","button")
        var productarry = [];
        $("input").click(function () {
            var that = $(this)
            var P_id = that.attr("data-val")
            var selsct = that.is(":checked");
            if (selsct) {
                $("#price-form-sub").attr("type", "submit")
                productarry.push(P_id)
            } else {
                productarry.remove(P_id)
                if (productarry.length == 0) {
                    $("#price-form-sub").attr("type","button")
                }
            }
        })
        $("#price-form-sub").on("click", function () {
            if (productarry.length == 0) {
                errorAlert("请选择报价产品")
            } else {
                $("#price_form").attr("action", "/SalesProcess/getQuotePrice?SalesSystemId=" + getUrlParam('SalesSystemId') + "&productId=" + productarry)
                $.ajax({
                    url: "/SalesProcess/QuotePricrListPartial",
                    data: {
                        query: $("#quotePrice-query").val(),
                        SalesSystemId: getUrlParam('SalesSystemId')
                    },
                    success: function (data) {
                        $("#quotePrice_list_content").html(data)
                        $('.modal-backdrop.in').remove()
                        $('body').removeClass('modal-open')
                    }
                });
             }
           
        })
    })
</script>