@{
    ViewBag.Title = "CRM_undelivered";
    Layout = "~/Views/Shared/_SalesProcessLayout.cshtml";
}
@*<table class="offline-search-box">
        <tr>
            <td class="pull-right">
                <label>订单名称：</label>
                <input class="form-control input-sm offline-search-inline" id="storage-product-query" placeholder="搜索内容" />
                <a class="btn btn-info btn-sm" id="storage-product-search"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</a>
            </td>
        </tr>
    </table>*@
<div class="select-btn">
    <a class="btn btn-info btn-sm status-btn" id="first_btn" data-val="3531567"><i class="fa fa-times-circle"></i>&nbsp;&nbsp;未同步ERP订单</a>
    <a class="btn btn-info btn-sm status-btn" id="second_btn" data-val="3531568"><i class="fa fa-question-circle"></i>&nbsp;&nbsp;已同步ERP订单</a>
    <a class="btn btn-info btn-sm status-btn" id="third_btn" data-val="3764330"><i class="fa fa-check-circle"></i>&nbsp;&nbsp;已发货订单</a>
    <a class="btn btn-info btn-sm status-btn" id="renovate_btn"><i class="fa fa-refresh"></i>&nbsp;&nbsp;刷新</a>
</div>
<div id="undelivered_list_content" style="margin-top:20px">
</div>
@section scripts{
    <script>
        $(function () {
            $("#first_btn").addClass("btn-danger")
            // 获取user_token
            $.ajax({
                url: "/SalesProcess/GetUserToken/",
                type: "post",
                success: function (data) {
                }
            })
            // 获取crm客户数据
            $.ajax({
                url: "/SalesProcess/GetCustomer/",
                data: {
                    url_api: "/api/v2/customers"
                },
                success: function (data) {
                }
            })
            // 获取crm合同数据
            $.ajax({
                url: "/SalesProcess/GetCrmInfo/",
                data: {
                    url_api: "/api/v2/contracts"
                },
                success: function (data) {
                    if (data.result == "SUCCESS") {
                        //数据保存完再请求数据页面
                        $.ajax({
                            url: "/SalesProcess/CRM_undeliveredPartical/",
                            data: {
                                status: $("#first_btn").attr("data-val")
                            },
                            success: function (data) {
                                $("#undelivered_list_content").html(data)
                            }
                        })
                    } else {
                        confirm("数据获取失败", "是否刷新", function (Confirm) {
                            if (Confirm) {
                                window.location.reload();
                            }
                        })
                    }
                }
            })
            // 获取合同详情
            $.ajax({
                url: "/SalesProcess/GetCrmDetailInfo/",
                success: function (data) {
                    if (data.result == "FAIL") {
                        confirm("数据获取失败", "是否刷新", function (Confirm) {
                            if (Confirm) {
                                window.location.reload();
                            }
                        })
                    }
                }
            })
            // 选择
            $(".status-btn").on("click", function () {
                var that = $(this)
                $(".select-btn .status-btn").removeClass("btn-danger");
                that.addClass("btn-danger");
                $.ajax({
                    url: "/SalesProcess/CRM_undeliveredPartical",
                    data: {
                        status: $(this).attr("data-val"),
                    },
                    success: function (data) {
                        $("#undelivered_list_content").html(data)
                    }
                })
            })
            // 刷新
            $("#renovate_btn").on("click", function () {
                window.location.reload();
            })
        });
    </script>
}