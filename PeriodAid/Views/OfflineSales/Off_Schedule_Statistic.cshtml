
@{
    ViewBag.Title = "Off_Schedule_Statistic";
    Layout = "~/Views/Shared/_OffLayout.cshtml";
}
@section page{
    2
    }
@section header{
    <style>
        .count{
        list-style-type:none;
        padding-left:1px;
        }
        .count li {
        padding:10px 0 10px 0;
        }
    </style>
    }
<div id="countList" class="container">
    <div class="hidden" id="currentdate">@(Convert.ToDateTime(ViewBag.CurrentDate).ToString("yyyy-MM-dd"))</div>
    <div class="row">
        <div class="col-md-4">
            <input type="text" id="date-time" name="date-time" class="form-control" placeholder="活动时间">
        </div>
        <div class="col-md-2">
            <button id="search-btn" class="btn btn-primary">搜索</button>
        </div>
    </div><br />
    <div class="row">
        <div class="col-md-4">
            <ul class="count">
                <li class="row">
                    <div class="col-md-4 h5"><strong>门店总数：</strong></div>
                    <div class="col-md-8">
                        
                            <div id="totalcount" class="progress-bar-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;text-align:center;">
                                60%
                            </div>
       
                    </div>
                    @*<div class="input-group">
                        <div class="input-group-addon"><small>门店总数</small></div>
                        <input type="text" id="totalcount" class="input-sm form-control" value="" disabled/>
                    </div>*@
                </li>
                <li class="row">
                    <div class="col-md-4 h5"><strong>已签到：</strong></div>
                    <div class="col-md-8">
                        
                            <div id="selfcount" class="progress-bar-danger" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;text-align:center;">
                                60%
                            </div>
                       
                    </div>
                    @*<div class="input-group">
                        <div class="input-group-addon"><small>已签到</small></div>
                        <input type="text" id="selfcount" class="input-sm form-control" value="" disabled/>
                    </div>*@
                </li>
                <li class="row">
                    <div class="col-md-4 h5"><strong>代签到：</strong></div>
                    <div class="col-md-8">
                       
                            <div id="proxycount" class="progress-bar-warning" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="text-align:center;">
                                60%
                            </div>
                        
                    </div>
                    @*<div class="input-group">
                        <div class="input-group-addon"><small>代签</small></div>
                        <input type="text" id="proxycount" class="input-sm form-control" value="" disabled/>
                    </div>*@
                </li>
                <li class="row">
                    <div class="col-md-4 h5"><strong>其他：</strong></div>
                    <div class="col-md-8">                       
                            <div id="restcount" class="progress-bar-info" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;text-align:center;">
                                60%
                            </div>                       
                    </div>
                </li>
                <li class="row">
                    <div class="col-md-4 h5"><strong>签到率：</strong></div>
                    <div class="col-md-8">
                        <div id="rate" style="margin-top:-7px;"></div>
                    </div>
                </li>
            </ul>
        </div>
        <div class="col-md-8">
            <div class="row text-center">
           
                    <div style="padding-top:10px;"><strong style="font-size:24px;">活动签到数据饼状图</strong></div>
                
                <div id="canvas-map"><canvas id="myChart" width="200" height="200" style=""></canvas></div>
                    <ul class="count">
                        <li style="float:left;margin-left:300px;">
                            <div style="font-size:12px;">
                                <span class="glyphicon glyphicon-stop" aria-hidden="true" style="color:#d9534f"></span> 签到
                            </div>
                        </li>
                        <li style="float:left;margin-left:15px;margin-right:15px;">
                            <div style="font-size:12px;">
                                <span class="glyphicon glyphicon-stop" aria-hidden="true" style="color:#f0ad4e"></span> 代签到
                            </div>
                        </li>
                        <li style="float:left;">
                            <div style="font-size:12px;">
                                <span class="glyphicon glyphicon-stop" aria-hidden="true" style="color:#5bc0de"></span> 其他
                            </div>
                        </li>
                    </ul>
                </div>
    </div>
</div>
</div>
<script src="~/Scripts/Chart.js" type="text/javascript"></script>
<script>
    $("#date-time").datepicker({
        dateFormat: 'yy-mm-dd'
    })
    $(function () {
        $("#date-time").val($("#currentdate").text())
        var url = "/OfflineSales/Off_Schedule_Statistic_Ajax";
        $.ajax({
            url: url,
            type: "post",
            data: {
                datetime: $("#currentdate").text()
            },
            success: function (data) {
                if (data.result == "SUCCESS") {
                    $("#totalcount").text(data.totalcount);
                    $("#totalcount").addClass("width", data.totalcount + "%");
                    $("#totalcount").attr({
                        "aria-valuenow": data.totalcount,
                        "aria-valuemax": data.totalcount
                    });
                    $("#selfcount").text(data.selfcount);
                    $("#selfcount").css("width", ((parseFloat(data.selfcount) / parseFloat(data.totalcount)) * 100 + "%"));
                    $("#selfcount").attr({
                        "aria-valuenow": data.selfcount,
                        "aria-valuemax": data.totalcount
                    });
                    $("#proxycount").text(data.proxycount);
                    $("#proxycount").css("width", ((parseFloat(data.proxycount) / parseFloat(data.totalcount)) * 100 + "%"));
                    $("#proxycount").attr({
                        "aria-valuenow": data.proxycount,
                        "aria-valuemax": data.totalcount
                    });
                    $("#restcount").text(data.restcount);
                    $("#restcount").css("width", ((parseFloat(data.restcount) / parseFloat(data.totalcount)) * 100 + "%"));
                    $("#restcount").attr({
                        "aria-valuenow": data.restcount,
                        "aria-valuemax": data.totalcount
                    });
                    $("#rate").text(((data.selfcount / data.totalcount) * 100).toFixed(2) + "%");
                    //$("#countList").html(data);
                    //制作饼状图
                    var pieData = [
                                 {
                                     value: data.selfcount,
                                     color: "#d9534f",
                                     //highlight: "#FF5A5E",
                                     label: "签到"
                                 },
                                 {
                                     value: data.proxycount,
                                     color: "#f0ad4e",
                                     //highlight: "#5AD3D1",
                                     label: "代签到"
                                 },
                                 {
                                     value: data.restcount,
                                     color: "#5bc0de",
                                     //highlight: "#FFC870",
                                     label: "其他"
                                 },
                    ];
                    var ctx = document.getElementById("myChart").getContext("2d");
                    new Chart(ctx).Pie(pieData);
                }
            }

        });
        $("#search-btn").click(function () {
            var url = "/OfflineSales/Off_Schedule_Statistic_Ajax";
            var datetime = $("#date-time").val();
            //alert(datetime)
            $.ajax({
                url: url,
                type: "post",
                data: {
                    datetime: datetime
                },
                success: function (data) {
                    if (data.result == "SUCCESS") {
                        $("#totalcount").text(data.totalcount);
                        $("#totalcount").addClass("width", data.totalcount + "%");
                        $("#totalcount").attr({
                            "aria-valuenow": data.totalcount,
                            "aria-valuemax": data.totalcount
                        });
                        $("#selfcount").text(data.selfcount);
                        $("#selfcount").css("width", ((parseFloat(data.selfcount) / parseFloat(data.totalcount)) * 100 + "%"));
                        $("#selfcount").attr({
                            "aria-valuenow": data.selfcount,
                            "aria-valuemax": data.totalcount
                        });
                        $("#proxycount").text(data.proxycount);
                        $("#proxycount").css("width", ((parseFloat(data.proxycount) / parseFloat(data.totalcount)) * 100 + "%"));
                        $("#proxycount").attr({
                            "aria-valuenow": data.proxycount,
                            "aria-valuemax": data.totalcount
                        });
                        $("#restcount").text(data.restcount);
                        $("#restcount").css("width", ((parseFloat(data.restcount) / parseFloat(data.totalcount)) * 100 + "%"));
                        $("#restcount").attr({
                            "aria-valuenow": data.restcount,
                            "aria-valuemax": data.totalcount
                        });
                        $("#rate").val(((data.selfcount / data.totalcount) * 100).toFixed(2) + "%");
                        //$("#countList").html(data);
                        //制作饼状图
                        var pieData = [
                                     {
                                         value: data.selfcount,
                                         color: "#d9534f",
                                         //highlight: "#FF5A5E",
                                         label: "签到"
                                     },
                                     {
                                         value: data.proxycount,
                                         color: "#f0ad4e",
                                         //highlight: "#5AD3D1",
                                         label: "代签到"
                                     },
                                     {
                                         value: data.restcount,
                                         color: "#5bc0de",
                                         //highlight: "#FFC870",
                                         label: "其他"
                                     },
                        ];
                        $("#myChart").remove();
                        $("#canvas-map").html("<canvas id=\"myChart\" width=\"200\" height=\"200\"></canvas>");
                        var ctx = document.getElementById("myChart").getContext("2d");
                        new Chart(ctx).Pie(pieData);
                    }
                }
            })
            return false
        });
    })
    
   
</script>

