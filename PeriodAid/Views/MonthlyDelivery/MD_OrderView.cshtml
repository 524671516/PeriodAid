@{
    ViewBag.Title = "MD_OrderView";
    Layout = "~/Views/Shared/_MonthlyDeliveryLayout.cshtml";
}
<table class="offline-search-box" style="margin-bottom:10px">
    <tr>
        <td class="float-right">
            <label>手工录入(最近7天)：</label>
            <input class="form-control input-sm offline-search-inline" style="height:30px" id="select_erporder" placeholder="请输入ERP平台单号" />
            <a class="btn btn-danger btn-sm" id="erporder_search"><i class="fa fa-search"></i>&nbsp;&nbsp;录入</a>
        </td>
    </tr>
</table>
<table class="offline-search-box" style="margin-bottom:10px">
    <tr>
        <td class="float-right">
            <label>历史录入(7天以前)：</label>
            <input class="form-control input-sm offline-search-inline" style="height:30px" id="select_history_erporder" placeholder="请输入历史ERP平台单号" />
            <a class="btn btn-danger btn-sm" id="history_erporder_search"><i class="fa fa-search"></i>&nbsp;&nbsp;录入</a>
        </td>
    </tr>
</table>
<table class="offline-search-box" style="margin-bottom:0">
    <tr>
        <td class="pull-right">
            <label>搜索订单：</label>
            <input class="form-control input-sm offline-search-inline" style="height:30px" id="order_query" placeholder="请输入内容" data-toggle="tooltip" data-placement="bottom" title="支持【订单号、产品代码】的模糊搜索" />
            <a class="btn btn-info btn-sm" id="order_search"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</a>
        </td>
    </tr>
</table>
@*<div class="select-btn">
        <a class="btn btn-info btn-sm status-btn btn-danger" id="first_btn" data-val="0"><i class="fa fa-times-circle"></i>&nbsp;&nbsp;未完结的订单</a>
        <a class="btn btn-info btn-sm status-btn" id="second_btn" data-val="1"><i class="fa fa-check-circle"></i>&nbsp;&nbsp;已完结的订单</a>
    </div>*@
<ul class="nav nav-tabs" style="margin-top:20px" role="tablist">
    <li role="presentation" class="order-list-li active"><a class="order_btn" aria-controls="home" role="tab" data-toggle="tab" data-cstatus="-1" style="cursor:pointer">全部订单</a></li>
    <li role="presentation" class="order-list-li"><a class="order_btn" aria-controls="profile" role="tab" data-toggle="tab" data-cstatus="1" style="cursor:pointer">已生成复购的订单</a></li>
    <li role="presentation" class="order-list-li"><a class="order_btn" aria-controls="profile" role="tab" data-toggle="tab" data-cstatus="0" style="cursor:pointer">未生成复购的订单</a></li>
</ul>
<div class="tm-veiw-loading text-center" id="tm-view-loading" style="height:100%">
    <i class="fa fa-spinner fa-pulse fa-3x fa-fw color-blue"></i><br><h4>数据加载中，请勿刷新界面！</h4>
</div>
<div id="order_list_content">
</div>
@section scripts{
    <script>
        $(function () {
            $("#ul-hover").children("li").eq(1).addClass("current")
            $('[data-toggle="tooltip"]').tooltip();
            $.ajax({
                url: "/MonthlyDelivery/MD_OrderPartialView/",
                data: {
                    page:1,
                    query: $("#order_query").val(),
                    create_status: "-1",
                },
                success: function (data) {
                    $("#order_list_content").html(data)
                    $("#tm-view-loading").hide()
                }
            })
            //回车绑定
            $(document).keyup(function (event) {
                if (event.keyCode == 13) {
                    $("#order_search").trigger("click")
                }
            });
            // 查询
            $("#order_search").click(function () {
                $.ajax({
                    url: "/MonthlyDelivery/MD_OrderPartialView/",
                    type:"post",
                    data: {
                        page: 1,
                        query: $("#order_query").val(),
                        create_status: $(".active").children(".order_btn").attr("data-cstatus")
                    },
                    success: function (data) {
                        $("#order_list_content").html(data)
                    }
                })
            })
            // 手工录入ERP订单信息
            $("#erporder_search").on("click", function () {
                var that = $(this)
                that.addClass("disabled")
                $.ajax({
                    url: "/MonthlyDelivery/getSingleErpOrder/",
                    type: "post",
                    data: {
                        platform_code: $("#select_erporder").val()
                    },
                    success: function (data) {
                        if (data.result == "SUCCESS") {
                            $.ajax({
                                url: "/MonthlyDelivery/MD_OrderPartialView/",
                                type: "post",
                                data: {
                                    page: 1,
                                    query: $("#order_query").val(),
                                    create_status: $(".active").children(".order_btn").attr("data-cstatus")
                                },
                                success: function (data) {
                                    $("#order_list_content").html(data)
                                    $("#select_erporder").val("")
                                    that.removeClass("disabled")
                                    $.alert({
                                        title: '提示!',
                                        content: '录入成功!',
                                        type: 'green',
                                    });
                                }
                            })
                        }
                        else if (data.result == "ERROR") {
                            $.alert({
                                title: '提示!',
                                content: '订单已存在!',
                                type: 'red',
                            });
                            that.removeClass("disabled")
                        }
                        else if (data.result == "NOTFOUND") {
                            $.alert({
                                title: '提示!',
                                content: '请输入正确的ERP单号!',
                                type: 'red',
                            });
                            that.removeClass("disabled")
                        }
                        else if (data.result == "FAIL") {
                            $.alert({
                                title: '提示!',
                                content: '请输入月月送单号!',
                                type: 'red',
                            });
                            that.removeClass("disabled")
                        } else {
                            $.alert({
                                title: '提示!',
                                content: '系统错误,请刷新后重试!',
                                type: 'red',
                            });
                            that.removeClass("disabled")
                        }
                    }
                })
            })
            // 历史订单录入
            $("#history_erporder_search").on("click", function () {
                var that = $(this)
                that.addClass("disabled")
                $.ajax({
                    url: "/MonthlyDelivery/getSingleHistoryErpOrder/",
                    type: "post",
                    data: {
                        platform_code: $("#select_history_erporder").val()
                    },
                    success: function (data) {
                        if (data.result == "SUCCESS") {
                            $.ajax({
                                url: "/MonthlyDelivery/MD_OrderPartialView/",
                                type: "post",
                                data: {
                                    page: 1,
                                    query: $("#order_query").val(),
                                    create_status: $(".active").children(".order_btn").attr("data-cstatus")
                                },
                                success: function (data) {
                                    $("#order_list_content").html(data)
                                    $("#select_history_erporder").val("")
                                    that.removeClass("disabled")
                                    $.alert({
                                        title: '提示!',
                                        content: '录入成功!',
                                        type: 'green',
                                    });
                                }
                            })
                        }
                        else if (data.result == "ERROR") {
                            $.alert({
                                title: '提示!',
                                content: '订单已存在!',
                                type: 'red',
                            });
                            that.removeClass("disabled")
                        }
                        else if (data.result == "NOTFOUND") {
                            $.alert({
                                title: '提示!',
                                content: '请输入正确的ERP单号!',
                                type: 'red',
                            });
                            that.removeClass("disabled")
                        }
                        else if (data.result == "FAIL") {
                            $.alert({
                                title: '提示!',
                                content: '请输入月月送单号!',
                                type: 'red',
                            });
                            that.removeClass("disabled")
                        }
                        else {
                            $.alert({
                                title: '提示!',
                                content: '系统错误,请刷新后重试!',
                                type: 'red',
                            });
                            that.removeClass("disabled")
                        }
                    }
                })
            })
            // 订单选择
            $(".order_btn").on("click", function () {
                var that = $(this)
                $.ajax({
                    url: "/MonthlyDelivery/MD_OrderPartialView/",
                    data: {
                        page: 1,
                        query: $("#order_query").val(),
                        create_status: that.attr("data-cstatus")
                    },
                    success: function (data) {
                        $("#order_list_content").html(data)
                    }
                })
            })
        })
    </script>
}