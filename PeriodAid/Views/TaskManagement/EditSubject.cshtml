@model PeriodAid.Models.Subject

<div class="form-group">
    <div class="h4">项目封面</div><br />
    <div>
    @if (Model.PicUrl != null) {
        <img id="PicUrl-img" class="img-rounded img-responsive edit-cover-img" src="http://cdn2.shouquanzhai.cn/@Model.PicUrl" style="float:left;margin-right:20px;" />
    }
    else
    {
        <img id="PicUrl-img" class="img-rounded img-responsive edit-cover-img" src="~/Content/images/cover-default.jpg" style="float:left;margin-right:20px;" />
    }
    <button class="btn btn-primary float-left"  onclick="javascript:openUpload();"><span class="glyphicon glyphicon-open" aria-hidden="true"></span>上传封面图</button> <br /><br />图片大小建议260px*100px</div>

    <input type="file" id="report-file" name="report-file" class="hidden" accept=".jpg,.png,.gif" />
</div>
@using (Html.BeginForm("EditSubject", "TaskManagement", FormMethod.Post, new { @id = "edit_subject_form", @class = "validate-form" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary()
    @Html.HiddenFor(m=>m.Id)
    @Html.HiddenFor(m=>m.Status)
    @Html.HiddenFor(m=>m.TemplateId)
    @Html.HiddenFor(m=>m.CreateTime)
    @Html.HiddenFor(m => m.PicUrl)
    
    <div class="clear-float"></div>
    <br />
    <div class="form-group">
        <div class="h4">项目名称</div><br />
        <input class="subject-name form-control" placeholder="项目名称" name="SubjectTitle" value="@Html.Encode(Model.SubjectTitle)">
        <br />
    </div>
    <div class="form-group">
        <div class="h4">项目简介(选填)</div><br />
        <textarea class="subject-description form-control" placeholder="项目简介（选填）" name="Remarks">@Html.Encode(Model.Remarks)</textarea>
        <br />
    </div>
    <div class="form-group">
        <label for="HolderId" class="h4">项目管理员</label><br />
        @Html.DropDownListFor(m => m.HolderId, ViewBag.EmployeeDropDown as SelectList, new { @class = "form-control" })
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="btn-edit-subject">保存</button>
    </div>
    <br /><br />
    <div>
        <hr />
        <div class="h4">进阶操作</div><br />
        <div class="text-right"><a href="javascript:;" class="btn btn-lg btn-warning">归档项目</a>&nbsp;&nbsp;<a href="javascript:;"class="btn btn-lg btn-danger">删除项目</a></div>
        
    </div>
    
}
<script>
    //编辑项目验证
    $(function () {
        $("#edit_subject_form").validate({
            debug: true,
            //验证通过的正式提交函数
            submitHandler: function (form) {
                console.log("3")
                $(form).ajaxSubmit(function (data) {
                    if (data == "SUCCESS") {
                        UnimportantAlert("添加项目成功");
                        $("#btn-edit-subject").removeClass("disabled");
                        $('#Edit-Subject').modal('hide');
                        GetActiveSubject("#personal_active_subject")
                    } else {
                        ErrorAlert(data);
                        $("#btn-edit-subject").removeClass("disabled");
                    }
                })
            },
            errorClass: "has-error",
            //验证失败
            errorPlacement: function (error, element) {
                $("#btn-edit-subject").removeClass("disabled");
            }
        });
        //编辑项目的提交
        $("#btn-edit-subject").on("click", function () {
            if (!$(this).hasClass("disabled")) {
                $(this).addClass("disabled")
                //console.log(33);
                $("#edit_subject_form").submit();
            }
        });
    })
    
</script>
