@model IEnumerable<PeriodAid.Models.SubTask>
<div class="col-md-12 margin-bottom-10">
    <div class="tm_modal_list">
        <div class="tm_modal_body">
            <ul>
                @foreach (var item in Model)
                {
                    <li class="tm_modal_list-header">
                        <div class="tm-list-item_top clear-float">
                                <div class="tm_modal_list-left tm_left_icon">
                                    <input type="checkbox" style="width:20px;height:20px;" class="margin-0" />
                                </div>
                                <div class="tm_modal_list-middle add-btn" data-sbid="@item.Id">@Html.Encode(item.TaskTitle)</div>
                                <div class="tm_modal_list-right"><a href="javascript:;">了解详情>></a></div>
                            </div>
                        <div class="tm_modal_list-footer hidden add-subtask-write"></div>
                    </li>
                }
            </ul>
        </div>
        <div class="tm_modal_list-header clear-float">
            <div class="tm-list-item_top clear-float">
                <div class="tm_modal_list-left tm_left_icon">
                    <span>
                        <i class="fa fa-plus-circle  color-blue icon-size" aria-hidden="true"></i>
                    </span>
                </div>
                <div class="tm_modal_list-middle add-btn" data-sbid="">添加子任务</div>
                <div class="tm_modal_list-right"></div>
            </div>
            <div class="tm_modal_list-footer hidden add-subtask-write"></div>
        </div>
    </div>
</div>

<script>
    //内置子任务弹出处理
    $(".add-btn").on("click", function (event) {
        var that = $(this);
        if (that.parent().parent().find(".add-subtask-write").html() == "") {
            $(".add-subtask-write").html("").addClass("hidden");
            $.ajax({
                url: "/TaskManagement/GetSubtaskForm",
                data: {
                    AssignmentId: $(".modal-header").attr("data-aid"),
                    SubtaskId: that.attr("data-sbid")
                },
                success: function (data) {
                    that.parent().parent().find(".add-subtask-write").html(data).removeClass("hidden");
                }

            })
        }
        if (that.parent().parent().find(".add-subtask-write").hasClass("hidden")) {
            that.parent().parent().find(".add-subtask-write").removeClass("hidden")
        } else {
            that.parent().parent().find(".add-subtask-write").addClass("hidden")
        }
    });
</script>

