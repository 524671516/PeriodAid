@model IEnumerable<PeriodAid.Models.Subject>
<h3 style="position:relative">
    <i class="fa fa-tasks color-blue" aria-hidden="true"></i>&nbsp;
    正在执行的项目&nbsp;
    <button type="button" id="bt_new_mess" class="color-gray btn btn-primary" style="color:white">
        全部消息</button>
            
</h3>

<div class="card-box row">
    @if (Model.Count() != 0)
    {
        foreach (var item in Model)
        {
            <div class="col-md-3 card-wrap" title="@item.SubjectTitle" data-toggle="tooltip" data-placement="top">
                @if (item.PicUrl != null)
                    {
                    <div class="card-item tm-show-subject-page" style="background-image: url('http://cdn2.shouquanzhai.cn/@item.PicUrl');" data-sid="@item.Id">
                        <div class="card-header clear-float">
                            <div class="card-header-left float-left card-title text-shadow">@Html.Encode(item.SubjectTitle)</div>
                            <div class="card-header-right float-right card-edit-btn" data-link="@item.Id"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></div>
                        </div>
                        <div class="card-body">

                        </div>
                            <div class="card-footer text-shadow">
                                @item.CreateTime.ToString("yyyy-MM-dd")
                               
                            </div>
                    <div class="card-mask"></div>
                    </div>
                }
                else
                {
                    <div class="card-item tm-show-subject-page" style="background-image: url('/Content/images/cover-default.jpg');" data-sid="@item.Id">
                        <div class="card-header clear-float">
                            <div class="card-header-left float-left card-title text-shadow">@Html.Encode(item.SubjectTitle)</div>
                            <div class="card-header-right float-right card-edit-btn" data-link="@item.Id"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></div>
                        </div>
                        <div class="card-body">

                        </div>
                        <div class="card-footer text-shadow">
                            @item.CreateTime.ToString("yyyy-MM-dd")
                            
                        </div>
                        <div class="card-mask"></div>
                    </div>
                }
            </div>
        }
    }
    <div class="col-md-3 card-wrap" id="add-task-card">
        <div class="card-item">
            <a id="add-task-card-btn" title="添加新项目" class="create_subject_target" href="javascript:;">
                <div id="add-task-card-icon"><i class="fa fa-plus-circle  fa-3x" aria-hidden="true"></i></div>
                <div id="add-task-card-word">添加新项目</div>
            </a>
        </div>
    </div>
</div>


<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">全部消息</h4>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row modal-nav-panel">
                        <div class="col-md-3 tm_modal_ul_wrap">
                            <ul class="list-group tm_modal-nav tm_modal_nav_ul">
                                <li class="list-group-item tm_active" data-href="/TaskManagement/NewLogs">未查看</li>
                                @*<li class="list-group-item" data-href="/TaskManagement/NewLogs">已查看</li>*@
                            </ul>
                        </div>
                        <div class="col-md-9   tm_modal_ul_wrap">
                            @*<p class="text-center" style="margin:0 auto;" id="loading-p"><a class="popover-title glyphicon " style="display:block">新操作消息</a></p>*@
                            
                            <div id="log_content"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="border:none;">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $("#bt_new_mess").hide()
        $("#bt_new_mess").click(function () {
            
            $('#myModal').modal()
            $.ajax({
                url: "/Taskmanagement/NewLogs/",
                type: "post",
                data: {
                },
                success: function (data) {
                    for (var item in data) {
                        console.log(data);
                        $("#log_content").html('');
                        for (i = 0; i < data[item].length; i++) {
                            if (data[item][i].IsNew == true) {
                                //$("#bt_new_mess").attr("data-content", data[item][i].LogsContent);
                                $("#log_content").append("<div class=\"popover-title\" style='text-align:center'>" + "项目【" + data[item][i].SubjectTitle + "】操作消息：" + "<h5 class=\"color-gray text-left\">" + data[item][i].LogsContent + "</h5></div>");
                            } 
                        }
                    }
                }
            })
        });
        
        
        

    })


</script>
